MODULE Fonts;
  IMPORT SYSTEM, Files;

  TYPE Font* = POINTER TO FontDesc;
    FontDesc* = RECORD
      name*: ARRAY 32 OF CHAR;
      height*, minX*, maxX*, minY*, maxY*: INTEGER;
      next*: Font;
      T: ARRAY 128 OF INTEGER;
      raster: ARRAY 2360 OF BYTE
    END ;

VAR Default*, root*: Font;

PROCEDURE GetPat*(fnt: Font; ch: CHAR; VAR dx, x, y, w, h, pa: INTEGER);
  VAR b: BYTE;
BEGIN pa := fnt.T[ORD(ch) MOD 80H];
  SYSTEM.GET(pa-3, b); dx := b; SYSTEM.GET(pa-2, b); x := b; SYSTEM.GET(pa-1, b);
  IF b < 128 THEN y := b ELSE y := b - 256 END;
  SYSTEM.GET(pa, b); w := b; SYSTEM.GET(pa+1, b); h := b
END GetPat;

PROCEDURE This*(name: ARRAY OF CHAR): Font;
  RETURN Default
END This;

PROCEDURE Free*;
BEGIN
END Free;

PROCEDURE InitRange(first, last, adr: INTEGER);
VAR i: INTEGER; w, h: BYTE;
BEGIN
  FOR i := first TO last DO
    Default.T[i] := adr + 3; SYSTEM.GET(adr+3, w); SYSTEM.GET(adr+4, h);
    INC(adr, 5 + (w + 7) DIV 8 * h)
  END
END InitRange;

BEGIN NEW(Default);
  Default.name := "Oberon10.Scn.Fnt"; Default.height := 12;
  Default.minX := 0; Default.maxX := 10;
  Default.minY := -3; Default.maxY := 9; Default.next := NIL;
  InitRange(  9 ,  9, SYSTEM.ADR($0C 00 00 00 00$));
  InitRange( 32,  51, SYSTEM.ADR($03 00 00 00 00 04 02 00 01 08 01 00 00 01 01 01 01 01 05 01 05 03 03 05 05 05 07 01 00 05 08 0A 0A 1F 0A 0A 1F 0A 0A 06 00 FF 05 0A 04 0F 14 14 0C 06 05 05 1E 04 08 01 00 06 08 1A 2A 2C 34 0B 0D 15 16 06 00 00 05 08 1B 0D 19 0A 04 0A 0A 0C 03 01 05 01 03 01 01 01 04 01 FE 03 0B 04 02 02 01 01 01 01 01 02 02 04 04 00 FE 03 0B 01 02 02 04 04 04 04 04 02 02 01 06 01 01 05 05 0A 04 1F 04 0A 06 01 01 05 05 04 04 1F 04 04 03 01 FE 01 04 01 01 01 01 06 01 03 05 01 1F 03 01 00 01 02 01 01 06 01 00 04 08 01 01 02 02 04 04 08 08 06 00 00 05 08 0E 11 11 11 11 11 11 0E 06 01 00 03 08 04 04 04 04 04 05 06 04 06 01 00 05 08 1F 01 02 04 04 08 08 07 06 01 00 04 08 07 08 08 08 07 08 08 07$));
  InitRange( 52,  71, SYSTEM.ADR($06 00 00 06 08 08 08 08 3F 09 0A 0C 08 06 01 00 04 08 07 08 08 08 07 01 02 0E 06 00 00 05 08 0E 11 11 13 0D 01 02 1C 06 00 00 05 08 02 02 04 04 08 08 10 1F 06 00 00 05 08 0E 11 11 11 0E 11 11 0E 06 00 00 05 08 07 08 10 16 19 11 11 0E 03 01 00 01 06 01 01 00 00 01 01 03 01 FE 01 08 01 01 01 01 00 00 01 01 06 00 00 06 06 30 0C 03 03 0C 30 06 01 02 05 03 1F 00 1F 06 00 00 06 06 03 0C 30 30 0C 03 05 01 00 04 08 02 00 02 02 04 08 08 07 0A 01 FE 08 0A 1C 02 6D B5 A5 A5 A5 B9 42 3C 07 00 00 07 08 41 41 22 3E 14 14 08 08 07 01 00 05 08 0F 11 11 11 0F 11 11 0F 06 01 00 05 08 1C 02 01 01 01 01 02 1C 08 01 00 06 08 0F 11 21 21 21 21 11 0F 06 01 00 04 08 0F 01 01 01 0F 01 01 0F 05 01 00 04 08 01 01 01 01 0F 01 01 0F 07 00 00 06 08 3C 22 21 21 01 01 02 1C$));
  InitRange( 72,  87, SYSTEM.ADR($07 01 00 05 08 11 11 11 11 1F 11 11 11 03 01 00 01 08 01 01 01 01 01 01 01 01 03 00 00 02 08 03 02 02 02 02 02 02 02 06 01 00 05 08 11 09 05 03 03 05 09 11 05 01 00 04 08 0F 01 01 01 01 01 01 01 09 00 00 09 08 11 01 11 01 11 01 AA 00 AA 00 AA 00 44 00 44 00 08 01 00 06 08 31 31 29 29 25 25 23 23 09 01 00 07 08 1C 22 41 41 41 41 22 1C 06 01 00 05 08 01 01 01 01 0F 11 11 0F 09 01 FE 07 0A 60 10 1C 22 41 41 41 41 22 1C 07 01 00 05 08 11 11 09 05 0F 11 11 0F 06 01 00 04 08 07 08 08 04 02 01 01 0E 05 00 00 05 08 04 04 04 04 04 04 04 1F 07 01 00 05 08 0E 11 11 11 11 11 11 11 06 00 00 06 08 0C 0C 12 12 12 21 21 21 0A 00 00 0A 08 84 00 84 00 4A 01 4A 01 4A 01 31 02 31 02 31 02$));
  InitRange( 88, 107, SYSTEM.ADR($07 01 00 05 08 11 11 0A 04 04 0A 11 11 05 00 00 05 08 04 04 04 04 0A 0A 11 11 06 01 00 04 08 0F 01 02 02 04 04 08 0F 04 01 FE 03 0B 07 01 01 01 01 01 01 01 01 01 07 06 01 FF 04 08 08 08 04 04 02 02 01 01 04 00 FE 03 0B 07 04 04 04 04 04 04 04 04 04 07 06 01 00 05 07 04 04 04 04 15 0A 04 03 00 03 03 01 07 05 01 07 02 02 02 01 06 01 00 04 06 0B 0D 09 0E 09 0E 06 01 00 04 09 07 09 09 09 0B 0D 01 01 01 05 01 00 04 06 07 09 01 01 01 0E 06 01 00 04 09 0B 0D 09 09 09 0E 08 08 08 06 01 00 04 06 07 09 01 0F 09 0E 03 00 00 03 09 02 02 02 02 02 07 02 02 06 06 01 FD 05 09 07 09 09 0E 02 07 09 09 1E 06 01 00 04 09 09 09 09 09 0B 0D 01 01 01 03 01 00 01 08 01 01 01 01 01 01 00 01 03 00 FD 02 0B 01 02 02 02 02 02 02 02 02 00 02 05 01 00 04 09 09 05 03 03 05 09 01 01 01$));
  InitRange(108, 126, SYSTEM.ADR($03 01 00 01 09 01 01 01 01 01 01 01 01 01 09 01 00 07 06 49 49 49 49 5B 6D 06 01 00 04 06 09 09 09 09 0B 0D 06 01 00 04 06 07 09 09 09 09 0E 06 01 FD 04 09 01 01 01 07 09 09 09 0B 0D 06 01 FD 04 09 08 08 08 0B 0D 09 09 09 0E 04 01 00 03 06 01 01 01 01 07 05 04 01 00 03 06 03 04 06 03 01 06 04 00 00 04 08 06 0A 02 02 02 0F 02 02 06 01 00 04 06 0B 0D 09 09 09 09 05 00 00 05 06 04 04 0A 0A 11 11 09 00 00 09 06 44 00 44 00 AA 00 AA 00 11 01 11 01 06 01 00 04 06 09 09 06 06 09 09 05 00 FD 05 09 01 02 02 04 04 0A 0A 11 11 04 00 00 04 06 0F 01 02 04 08 0F 04 00 FE 03 0B 04 02 02 02 02 01 02 02 02 02 04 05 02 FE 01 0B 01 01 01 01 01 01 01 01 01 01 01 04 01 FE 03 0B 01 02 02 02 02 04 02 02 02 02 01 06 00 02 06 02 19 26$));
  root := Default;
END Fonts.
